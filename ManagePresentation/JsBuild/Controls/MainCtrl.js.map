{"version":3,"names":[],"mappings":"","sources":["Controls/MainCtrl.js"],"sourcesContent":["function MainCtrl($scope,$http,CloudAccessService,$modal,$state,ValidationService,Popup,RefreshModelService){function refreshPlatformInfo(){CloudAccessService.GetPlatformInformation().then(function(platformInfo){$scope.Memory_Instance.heapTotal=platformInfo[0].Property[0].Value,$scope.Memory_Instance.heapUsed=platformInfo[0].Property[1].Value,$scope.Memory_Instance.Rss=platformInfo[0].Property[2].Value},function(error){\"身份无效\"==error.Message?$state.go(\"login\"):console.log(JSON.stringify(error))})}function CloseDialog(){$scope.Popup.PopupShow=!1}function PopupPressOK(envent){$scope.Popup.PopupShow=!1,RefreshModelService.RefreshModel($scope.Popup.Sender.entity.Id).then(function(data){ShowDurationTip(null,\"已返回信息:命令类型:\"+data.PackageType+\"    状态:\"+data.Status)},function(error){ShowDurationTip(null,error)})}function ShowTip(Title,Content,Key,sender){Title&&($scope.Popup.PopupTitle=Title),Content&&($scope.Popup.PopupContent=Content),Key&&($scope.Popup.PopupKey=Key),sender&&($scope.Popup.Sender=sender),$scope.Popup.PopupShow=!0}function ShowDurationTip(Title,Content,Key){Title&&($scope.DurationPopup.PopupTitle=Title),Content&&($scope.DurationPopup.PopupContent=Content),Key&&($scope.DurationPopup.PopupKey=Key),$scope.DurationPopup.PopupShow=!0}function CloseDurationPopup(){$scope.DurationPopup.PopupShow=!1}function refreshData(){CloudAccessService.GetCloudPlatformParams().then(function(data){var paramStruct=[];for(var item in data){var currentParam={};currentParam.ParamKey=item,currentParam.ParamValue=data[item];for(var item in data.ParamsComment)item==currentParam.ParamKey&&(currentParam.Discription=data.ParamsComment[item]);paramStruct.push(currentParam)}$scope.CloudServerRunParams=paramStruct},function(error){\"身份无效\"==error.Message?$state.go(\"login\"):console.log(JSON.stringify(error))}),RefreshCloudInfo()}function SetCloudPlatformParams(control){control&&(control.target.innerText=\"正在保存参数并重启云服务...\"),CloudAccessService.SetCloudPlatformParams($scope.CloudServerRunParams).then(function(data){control.target.innerText=\"保存参数并重启云平台\"},function(error){\"身份无效\"==error.Message?$state.go(\"login\"):console.log(JSON.stringify(error))})}function RefreshCloudInfo(control){void 0!=$scope.CommandList_RefreshTime&&null!=$scope.CommandList_RefreshTime&&$scope.CommandList_RefreshTime%1===0||($scope.CommandList_RefreshTime=3),$scope.CommandList_RefreshFlag?($scope.CommandList_RefreshFlag=!1,$scope.CommandList_RefreshButtonNotify=\"点击自动刷新(\"+$scope.CommandList_RefreshTime+\"秒/次)\",clearInterval($scope.CommandList_interval)):($scope.CommandList_RefreshFlag=!0,$scope.CommandList_RefreshButtonNotify=\"自动刷新中(点击停止)\",$scope.CommandList_interval=setInterval(function(){refreshPlatformInfo(),CloudAccessService.MonitoringCloudClient().then(function(data){if($scope.gridOptions={data:data},$scope.labels=[],$scope.data=[[],[]],data&&data.length>0)for(var index=0;index<data.length;index++)(control.indexOf(data[index].ClientName)>=0||control)&&($scope.labels.push(data[index].ClientName),$scope.data[0].push(data[index].CommandNumber),$scope.data[1].push(data[index].OperationChannel))},function(error){\"身份无效\"==error.Message?(clearInterval($scope.CommandList_interval),$state.go(\"login\")):console.log(\"call RefreshCloudInfo:\"+JSON.stringify(error))})},1e3*$scope.CommandList_RefreshTime))}function UserDestory(){ValidationService.UserInfo={},$state.go(\"login\")}function ToBusinessLog(){$state.go(\"log\")}$scope.ToBusinessLog=ToBusinessLog,$scope.SetCloudPlatformParams=SetCloudPlatformParams,$scope.RefreshCloudInfo=RefreshCloudInfo,$scope.UserDestory=UserDestory,$scope.CloseDialog=CloseDialog,$scope.PopupPressOK=PopupPressOK,$scope.CloseDurationPopup=CloseDurationPopup,$scope.FilterContent=\"\",$scope.CloudServerRunParams=[],$scope.CommandList_RefreshTime=3,$scope.CommandList_RefreshButtonNotify=\"点击自动刷新(\"+$scope.CommandList_RefreshTime+\"秒/次)\",$scope.CommandList_RefreshFlag=!1,$scope.CommandList_interval=null,$scope.UserInfo=ValidationService.UserInfo,$scope.labels=[],$scope.series=[\"当前通道数\",\"正在运行\"],$scope.data=[[],[]],$scope.Popup={PopupShow:!1,PopupTitle:\"消息\",PopupKey:\"Default\",PopupContent:\"提示消息\",Sender:{}},$scope.Memory_Instance={},$scope.Memory_Instance.heapTotal=\"0MB\",$scope.Memory_Instance.heapUsed=\"0MB\",$scope.Memory_Instance.Rss=\"0MB\",$scope.DurationPopup={PopupShow:!1,PopupTitle:\"消息\",PopupKey:\"Default\",PopupContent:\"提示消息\"},$scope.$watch(\"FilterContent\",function(newValue,oldValue,scope){RefreshCloudInfo(newValue)}),$scope.gridOptions={data:[],columnDefs:[{field:\"Id\",displayName:\"客户端编号\",width:\"30%\"},{field:\"ClientName\",displayName:\"单位\",width:\"20%\"},{field:\"ConnectionTime\",displayName:\"创建时间\"},{field:\"ACKTime\",displayName:\"ACK时间\"},{field:\"CommandNumber\",displayName:\"总通道数\"},{field:\"OperationChannel\",displayName:\"正在使用\"},{name:\" \",cellTemplate:'<div><a href=\"\"  ng-click=\"grid.appScope.toggle(row)\">刷新模型</a></div>'}],paginationPageSizes:[10,50,100]},$scope.toggle=function(row){ShowTip(\"重启云平台客户端\",\"您是否要重新刷新客户名为: '\"+row.entity.ClientName+\"' 的云平台客户端?\",\"RefreshModel\",row)},refreshData(),$scope.$on(\"$destroy\",function(){$scope.CloudServerRunParams=[],$scope.CommandList_RefreshTime=3,$scope.CommandList_RefreshButtonNotify=\"点击自动刷新(\"+$scope.CommandList_RefreshTime+\"秒/次)\",$scope.CommandList_RefreshFlag=!1,clearInterval($scope.CommandList_interval),$scope.CommandList_interval=null})}main.controller(\"MainCtrl\",MainCtrl),MainCtrl.$inject=[\"$scope\",\"$http\",\"CloudAccessService\",\"$modal\",\"$state\",\"ValidationService\",\"Popup\",\"RefreshModelService\"];"],"file":"Controls/MainCtrl.js","sourceRoot":"/source/"}